---
title: "Agent Commands"
description: "Let AI agents integrate Spaire checkout and usage billing directly into your codebase"
sidebarTitle: "Agent Commands"
---

Agent commands let AI coding agents read your codebase, detect your framework, and write production-ready Spaire integration code — interactively, with your approval at every step.

Instead of reading docs and writing boilerplate, you run a slash command and the agent handles the rest.

## Available Commands

<CardGroup cols={2}>
  <Card title="/setup-checkout" icon="cart-shopping" href="#setup-checkout">
    Adds checkout buttons, embed scripts, success pages, and optionally customer portal and webhook handlers.
  </Card>
  <Card title="/setup-usage-billing" icon="gauge" href="#setup-usage-billing">
    Sets up metered billing with SDK ingestion, meters, credits, and webhook handlers.
  </Card>
</CardGroup>

## Getting Started

<Steps>
  <Step title="Install Claude Code">
    ```bash
    npm install -g @anthropic-ai/claude-code
    ```
  </Step>
  <Step title="Open your project">
    ```bash
    cd your-project
    claude
    ```
  </Step>
  <Step title="Run a command">
    Type `/setup-checkout` or `/setup-usage-billing` and follow the agent's prompts.
  </Step>
</Steps>

## Supported Frameworks

Agent commands support the following frameworks out of the box:

| Framework | Checkout | Usage Billing |
|---|---|---|
| Next.js (App Router) | ✓ | ✓ |
| Next.js (Pages Router) | ✓ | ✓ |
| Express | ✓ | ✓ |
| FastAPI | ✓ | ✓ |
| Ruby on Rails | ✓ | ✓ |
| Node Serverless (Vercel/Lambda) | ✓ | ✓ |
| React (Vite, CRA) | ✓ | — |
| Vue / Nuxt | ✓ | — |
| Svelte / SvelteKit | ✓ | — |
| Vanilla HTML/JS | ✓ | — |

If the agent cannot confidently detect your framework, it will ask you to confirm before proceeding.

## Safety Guardrails

Agent commands are designed for production codebases that handle revenue. Every command enforces these guardrails automatically:

### Pre-write confirmation

Before writing any code, the agent presents a full change summary — every file it will create, every file it will modify, and what each change does. It then asks for explicit confirmation before proceeding. No code is written without your approval.

### Git safety

The agent checks for uncommitted changes at the start and warns you to commit or stash before proceeding. This ensures you can always revert cleanly.

### No secret handling

The agent never hardcodes API keys, access tokens, or webhook secrets. It never modifies `.env` values. It only references environment variable names and tells you where to get the values.

### Surgical edits

When modifying existing files, the agent patches only the necessary sections. It preserves your formatting, indentation, and code style. It never rewrites entire files unless you explicitly confirm.

### No silent account mutations

The agent writes code and guides you through dashboard steps. It never creates products, meters, prices, or any billing objects in your Spaire account automatically. You always do that yourself in the dashboard.

### Idempotent webhooks

All generated webhook handlers include signature verification and idempotency checks to prevent double-processing of events.

### Revert instructions

After every implementation, the agent provides specific revert instructions — exact file paths to remove, imports to delete, packages to uninstall — so you can undo everything cleanly.

<Tip>
  We strongly recommend committing your current changes before running any agent command. This gives you a clean `git diff` to review and a one-command revert path via `git checkout .` if needed.
</Tip>

## Setup Checkout

The `/setup-checkout` command adds Spaire checkout to your project. It supports three approaches:

### Overlay (simplest)

No backend needed. The agent adds an embed script and `data-spaire-checkout` links. Best for landing pages and simple apps.

```html
<a href="__CHECKOUT_LINK__" data-spaire-checkout data-spaire-checkout-theme="light">
  Get Started
</a>
```

### Programmatic

Uses `SpaireEmbedCheckout.create()` for dynamic control. Best when you need to trigger checkout from JavaScript with custom metadata.

### Server-side

Creates checkout sessions via `@spaire/sdk` or `@spaire/nextjs`. Full control over line items, discounts, and metadata.

### What the agent does

1. Detects your framework by scanning project files
2. Asks if you have products in Spaire (walks you through creation if not)
3. Asks which approach you want (overlay, programmatic, server-side)
4. Scans for pricing pages, product pages, and CTA sections
5. Shows a change summary and waits for confirmation
6. Adds the embed script to your layout
7. Writes checkout buttons into your components
8. Creates a success page
9. Optionally wires up customer portal and webhook handler
10. Provides revert instructions

For full details, see the [Checkout documentation](/features/checkout/embed).

## Setup Usage Billing

The `/setup-usage-billing` command sets up metered billing in your project. It supports tracking:

- **LLM tokens** — prompt, completion, and total tokens via `LLMStrategy`
- **API calls** — request counting with custom metadata
- **Storage** — bytes uploaded/downloaded via `S3Strategy`
- **Compute time** — execution duration via `DeltaTimeStrategy`
- **Custom metrics** — any event you define

### What the agent does

1. Detects your framework by scanning project files
2. Asks what you want to meter and your pricing model
3. Checks prerequisites (SDK installed, access token set)
4. Tells you exactly what meter to create in the dashboard
5. Shows a change summary and waits for confirmation
6. Writes ingestion code using the right SDK strategy
7. Walks you through metered pricing setup
8. Optionally sets up credits with balance-checking utilities
9. Generates webhook handlers with signature verification
10. Provides revert instructions

For full details, see the [Usage-Based Billing documentation](/features/usage-based-billing/introduction).

## Production Awareness

If the agent detects production indicators in your environment — `NODE_ENV=production`, deploy branch configurations, or CI/CD pipeline files — it will warn you before making any changes.

<Warning>
  Agent commands write code directly into your project. Always review the generated code before deploying to production. Use [sandbox mode](/integrate/sandbox) for initial testing.
</Warning>

## Relationship to Other Integration Methods

Agent commands complement existing integration paths:

| Method | Best for |
|---|---|
| **Agent Commands** | Getting started fast — the agent writes the code for you |
| [SDKs](/integrate/sdk/typescript) | Manual integration with full control |
| [Framework Adapters](/integrate/sdk/adapters/nextjs) | Framework-specific helpers (Next.js, Express, etc.) |
| [MCP](/integrate/mcp) | AI agents querying your Spaire data at runtime |
| [Webhooks](/integrate/webhooks/endpoints) | Reacting to billing events server-side |

## Future Runtimes

Agent commands currently run in [Claude Code](https://docs.anthropic.com/en/docs/claude-code/overview). Support for additional AI coding environments — Cursor, GitHub Copilot, OpenAI Codex — is planned.
